"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React);function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _iterableToArrayLimit(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var u,c=t[Symbol.iterator]();!(n=(u=c.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var RouterContext=React.createContext();function Router(t){var e=t.children,r=_slicedToArray(React.useState({currentRoute:window.location.pathname,previousRoute:""}),2),n=r[0],o=r[1];return React.useEffect(function(){function t(){o(function(t){return{currentRoute:"/".concat(window.location.pathname).replace("//","/"),previousRoute:t.currentRoute}})}return window.addEventListener("popstate",t),function(){window.removeEventListener("popstate",t)}},[]),React__default.createElement(RouterContext.Provider,{value:_objectSpread2({setRoute:function(t){window.history.pushState({},null,t),o(function(t){return{currentRoute:window.location.pathname,previousRoute:t.currentRoute}})}},n)},e)}var IS_SSR="undefined"==typeof window,TRANSITION_STATES=["entering","entered","exiting","exited"],NEXT_STEP_MAP=[1,1,3,3];function mapToRegExp(t){var e=_slicedToArray(t,3),r=e[0],n=e[1],o=e[2],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=_slicedToArray(deconstructURL(normalisePath(o?"".concat(o,"/").concat(n):n)),2),c=u[0],i=u[1],l=c;return a?l="".concat(c,"\\/.*"):"/"===n&&(l="".concat(c,"\\/")),[new RegExp("".concat(l,"$"),"ig"),i,r]}function TransitionableReactRoute(t){var e=t.path,r=t.timeout,n=void 0===r?1e3:r,o=t.animateOnMount,a=t.children,u=Date.now(),c=React.useRef([]),i=React.useRef([]),l=React.useContext(RouterContext).currentRoute,s="".concat(l,"_").concat(u),p=_slicedToArray(React.useState(IS_SSR?[{state:o?0:1,key:s,timestamp:u,currentRoute:l}]:[]),2),f=p[0],y=p[1];return c.current.length||React__default.Children.forEach(a,function(t){var r=t.props,a=r.path,u=r.defaultpath,i=t.type===TransitionableReactRoute,l=_objectSpread2({},t.props,{fullPath:u?"defaultpath":normalisePath("".concat(e||"","/").concat(a)),timeout:n});i&&(l.animateOnMount=o);var s=React__default.cloneElement(t,l);u?c.current.push([/.*/gi,[!1],s]):c.current.push(mapToRegExp([s,a,e],i))}),React.useEffect(function(){return function(){i.current.forEach(clearTimeout),i.current=[]}},[]),React.useEffect(function(){y(function(t){var e=_toConsumableArray(t),r=Date.now(),a=(last(e)||{}).currentRoute,u=greedyMatchComponent(c.current,l),p=greedyMatchComponent(c.current,a),f=u.component&&u.component.type===TransitionableReactRoute;return p.component&&p.component.type===TransitionableReactRoute&&f||e.push({state:o?0:1,key:s,timestamp:r,currentRoute:l}),e.length>1&&(e[e.length-2]=_objectSpread2({},e[e.length-2],{now:r,state:2})),i.current.push(setTimeout(function(){y(function(t){for(var e=!1,r=Date.now(),o=_toConsumableArray(t),a=0;a<o.length;a++){var u=NEXT_STEP_MAP[o[a].state];r-o[a].timestamp>=n&&u!==o[a].state&&(e=!0,o[a]=_objectSpread2({},o[a],{state:u}))}return e?o.filter(function(t){return t.state<3}):t})},n)),e})},[l]),React.useMemo(function(){return f.map(function(t){var e=t.currentRoute,r=t.key,n=t.state,o=greedyMatchComponent(c.current,e);return o.component?React__default.createElement(o.component.type,_objectSpread2({key:r},o.component.props,{query:o.query,transitionstate:TRANSITION_STATES[n]})):null})},[f])}function greedyMatchComponent(t,e){var r=!0,n=!1,o=void 0;try{t:for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var c=_slicedToArray(a.value,3),i=c[0],l=c[1],s=c[2];i.lastIndex=0;var p=i.exec(e);if(p){for(var f={},y=0;y<l.length;y++)if("string"==typeof l[y]&&(f[l[y]]=p[y+1],!p[y+1]))continue t;return{component:s,query:f}}}}catch(t){n=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(n)throw o}}return{component:null,attributes:null}}function deconstructURL(t){var e=t.split("/");return"/"===t?["^",[!1]]:e.filter(function(t){return!!t}).reduce(function(t,e,r){var n=t[1];return 0===e.indexOf(":")?(n.push(e.substring(1)),["".concat(t[0],"\\/?([^\\/]+)?"),n]):(n.push(!1),r>0?["".concat(t[0],"\\/(").concat(e,")"),n]:["".concat(t[0],"(").concat(e,")"),n])},["^\\/",[]])}function normalisePath(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace("//","/")}function last(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t[t.length-1]}exports.Router=Router,exports.RouterContext=RouterContext,exports.TransitionableReactRoute=TransitionableReactRoute;