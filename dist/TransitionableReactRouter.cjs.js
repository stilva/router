"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React);const RouterContext=React.createContext();function Router({children:t}){const[e,n]=React.useState({currentRoute:window.location.pathname,previousRoute:""});return React.useEffect(()=>{function t(){n(t=>({currentRoute:`/${window.location.pathname}`.replace("//","/"),previousRoute:t.currentRoute}))}return window.addEventListener("popstate",t),function(){window.removeEventListener("popstate",t)}},[]),React__default.createElement(RouterContext.Provider,{value:{setRoute:t=>{window.history.pushState({},null,t),n(t=>({currentRoute:window.location.pathname,previousRoute:t.currentRoute}))},...e}},t)}const IS_SSR="undefined"==typeof window,TRANSITION_STATES=["entering","entered","exiting","exited"],NEXT_STEP_MAP=[1,1,3,3];function mapToRegExp([t,e,n],o=!1){const r=normalisePath(n?`${n}/${e}`:e),[u,a]=deconstructURL(r);let c=u;return o?c=`${u}\\/.*`:"/"===e&&(c=`${u}\\/`),[new RegExp(`${c}$`,"ig"),a,t]}function TransitionableReactRoute({animateOnMount:t,children:e,onRouteChange:n=noop,path:o,timeout:r=1e3,...u}){const a=Date.now(),c=React.useRef([]),i=React.useRef(r),s=React.useContext(RouterContext),l=s.currentRoute,R=`${l}_${a}`,[p,f]=React.useState(IS_SSR?[{state:t?0:1,key:R,timestamp:a,currentRoute:l}]:[]);return c.current.length||React__default.Children.forEach(e,e=>{const{path:n,defaultpath:u}=e.props,a=e.type===TransitionableReactRoute,i={...e.props,fullPath:u?"defaultpath":normalisePath(`${o||""}/${n}`),timeout:r};a&&(i.animateOnMount=t);const s=React__default.cloneElement(e,i);u?c.current.push([/.*/gi,[!1],s]):c.current.push(mapToRegExp([s,n,o],a))}),React.useEffect(()=>{n(l),u.transitionstate!==TRANSITION_STATES[2]&&f(e=>{const n=[...e],o=Date.now(),r=checkIfSameParent((last(n)||{}).currentRoute,s.currentRoute,c),u=n.length-1;return n.length>0&&n[u].state<2&&!r&&(n[u]={...n[u],timestamp:o,state:2}),r||n.push({state:t?0:1,key:R,timestamp:o,currentRoute:l}),n})},[l]),React.useEffect(()=>{let t,e=!1;const n=()=>{t=requestAnimationFrame(()=>{!e&&onAnimationEnd(f,i.current),n()})};return t=n(),()=>{e=!0,cancelAnimationFrame(t)}},[]),React.useEffect(()=>{r!==i.current&&(c.current=c.current.map(([t,e,n])=>{return[t,e,r!==n.props.timeout?React__default.cloneElement(n,{timeout:r}):n]}),i.current=r)},[r]),React.useMemo(()=>p.map(({currentRoute:t,key:e,state:n})=>{const o=greedyMatchComponent(c.current,t);return o.component?React__default.createElement(o.component.type,{key:e,...o.component.props,query:o.query,transitionstate:TRANSITION_STATES[n]}):null}),[p])}function checkIfSameParent(t,e,n){const o=matchRoute(n,t),r=matchRoute(n,e);return r&&o?o[o.length-1]===r[r.length-1]:null}function matchRoute(t,e){if(!e)return null;for(let[n]of t.current){n.lastIndex=0;const t=n.exec(e);if(t)return t}}function onAnimationEnd(t,e){t(t=>{let n=!1;const o=Date.now(),r=[...t];for(let t=0;t<r.length;t++){const u=NEXT_STEP_MAP[r[t].state];o-r[t].timestamp>=e&&u!==r[t].state&&(n=!0,r[t]={...r[t],state:u})}return n?r.filter(({state:t})=>t<3):t})}function greedyMatchComponent(t,e){t:for(let[n,o,r]of t){n.lastIndex=0;const t=n.exec(e);if(!t)continue;let u={};for(let e=0;e<o.length;e++)if("string"==typeof o[e]&&(u[o[e]]=t[e+1],!t[e+1]))continue t;return{component:r,query:u}}return{component:null,attributes:null}}function deconstructURL(t){const e=t.split("/");return"/"===t?["^",[!1]]:e.filter(t=>!!t).reduce((t,e,n)=>{const o=t[1];return 0===e.indexOf(":")?(o.push(e.substring(1)),[`${t[0]}\\/?([^\\/]+)?`,o]):(o.push(!1),n>0?[`${t[0]}\\/(${e})`,o]:[`${t[0]}(${e})`,o])},["^\\/",[]])}function normalisePath(t=""){return t.replace("//","/")}function last(t=[]){return t[t.length-1]}function noop(){}exports.Router=Router,exports.RouterContext=RouterContext,exports.TransitionableReactRoute=TransitionableReactRoute;