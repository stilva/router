"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React);function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(r,!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _iterableToArrayLimit(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var u,c=e[Symbol.iterator]();!(n=(u=c.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var RouterContext=React.createContext();function Router(e){var t=e.children,r=_slicedToArray(React.useState({currentRoute:window.location.pathname,previousRoute:""}),2),n=r[0],o=r[1];return React.useEffect(function(){function e(){o({currentRoute:"/".concat(window.location.pathname).replace("//","/"),previousRoute:n.currentRoute})}return window.addEventListener("popstate",e),function(){window.removeEventListener("popstate",e)}},[]),React__default.createElement(RouterContext.Provider,{value:_objectSpread2({setRoute:function(e){window.history.pushState({},null,e),o({currentRoute:window.location.pathname,previousRoute:n.currentRoute})}},n)},t)}var IS_SSR="undefined"==typeof window,TRANSITION_STATES=["entering","entered","exiting","exited"],NEXT_STEP_MAP=[1,1,3,3];function TransitionableReactRoute(e){var t=e.path,r=e.timeout,n=void 0===r?1e3:r,o=e.animateOnMount,a=e.children,u=e.preRouteChange,c=Date.now(),i=React.useRef([]),l=React.useRef([]),s=React.useContext(RouterContext),p=s.currentRoute,f="".concat(p,"_").concat(c),y=_slicedToArray(React.useState(IS_SSR?[{state:o?0:1,key:f,timestamp:c,currentRoute:p}]:[]),2),d=y[0],R=y[1];return i.current.length||React__default.Children.forEach(a,function(e){var r=e.props,a=r.path,u=r.defaultpath,c=e.type===TransitionableReactRoute,l=_objectSpread2({},e.props,{fullPath:u?"defaultpath":normalisePath("".concat(t||"","/").concat(a)),timeout:n});c&&(l.animateOnMount=o);var s=React__default.cloneElement(e,l);u?i.current.push([/.*/gi,[!1],s]):i.current.push(mapToRegExp([s,a,t],c))}),React.useEffect(function(){return function(){l.current.forEach(clearTimeout),l.current=[]}},[]),React.useEffect(function(){"function"==typeof u&&u(s.currentRoute,s.previousRoute),R(function(e){var t=_toConsumableArray(e),r=Date.now(),a=(last(t)||{}).currentRoute,u=greedyMatchComponent(i.current,p),c=greedyMatchComponent(i.current,a),s=u.component&&u.component.type===TransitionableReactRoute;return c.component&&c.component.type===TransitionableReactRoute&&s||t.push({state:o?0:1,key:f,timestamp:r,currentRoute:p}),t.length>1&&(t[t.length-2]=_objectSpread2({},t[t.length-2],{now:r,state:2})),l.current.push(setTimeout(function(){R(function(e){for(var t=!1,r=Date.now(),o=_toConsumableArray(e),a=0;a<o.length;a++){var u=NEXT_STEP_MAP[o[a].state];r-o[a].timestamp>=n&&u!==o[a].state&&(t=!0,o[a]=_objectSpread2({},o[a],{state:u}))}return t?o.filter(function(e){return e.state<3}):e})},n)),t})},[p]),React.useMemo(function(){return d.map(function(e){var t=e.currentRoute,r=e.key,n=e.state,o=greedyMatchComponent(i.current,t);return o.component?React__default.createElement(o.component.type,_objectSpread2({key:r},o.component.props,{query:o.query,transitionstate:TRANSITION_STATES[n]})):null})},[d])}function greedyMatchComponent(e,t){var r=!0,n=!1,o=void 0;try{e:for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var c=_slicedToArray(a.value,3),i=c[0],l=c[1],s=c[2];i.lastIndex=0;var p=i.exec(t);if(p){for(var f={},y=0;y<l.length;y++)if("string"==typeof l[y]&&(f[l[y]]=p[y+1],!p[y+1]))continue e;return{component:s,query:f}}}}catch(e){n=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(n)throw o}}return{component:null,attributes:null}}function mapToRegExp(e){var t=_slicedToArray(e,3),r=t[0],n=t[1],o=t[2],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=_slicedToArray(deconstructURL(normalisePath(o?"".concat(o,"/").concat(n):n)),2),c=u[0],i=u[1],l=c;return a?l="".concat(c,"\\/.*"):"/"===n&&(l="".concat(c,"\\/")),[new RegExp("".concat(l,"$"),"ig"),i,r]}function deconstructURL(e){var t=e.split("/");return"/"===e?["^",[!1]]:t.filter(function(e){return!!e}).reduce(function(e,t,r){var n=e[1];return 0===t.indexOf(":")?(n.push(t.substring(1)),["".concat(e[0],"\\/?([^\\/]+)?"),n]):(n.push(!1),r>0?["".concat(e[0],"\\/(").concat(t,")"),n]:["".concat(e[0],"(").concat(t,")"),n])},["^\\/",[]])}function normalisePath(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace("//","/")}function last(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e[e.length-1]}exports.Router=Router,exports.RouterContext=RouterContext,exports.TransitionableReactRoute=TransitionableReactRoute;